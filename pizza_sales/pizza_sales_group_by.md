`GROUP BY` and `HAVING` clauses

---

### **Basic Aggregations**

1. Find the total number of orders placed for each pizza.  
2. Calculate the total revenue generated by each pizza.  
3. List the total number of orders placed by each customer.  
4. Find the number of pizzas sold for each size.  
5. Calculate the total amount spent by each customer.  
6. Find the total number of orders placed on each day.  
7. List the number of customers who placed orders from each city.  
8. Find the total revenue generated each month.  
9. Calculate the total quantity of each topping ordered.  
10. Find the average order amount for each customer.  
---

### **Basic Aggregations**

1. **Find the total number of orders placed for each pizza.**  
   ```sql
   SELECT PizzaID, COUNT(*) AS TotalOrders
   FROM OrderItems
   GROUP BY PizzaID;
   ```

2. **Calculate the total revenue generated by each pizza.**  
   ```sql
   SELECT PizzaID, SUM(Quantity * Price) AS TotalRevenue
   FROM OrderItems
   GROUP BY PizzaID;
   ```

3. **List the total number of orders placed by each customer.**  
   ```sql
   SELECT CustomerID, COUNT(*) AS TotalOrders
   FROM Orders
   GROUP BY CustomerID;
   ```

4. **Find the number of pizzas sold for each size.**  
   ```sql
   SELECT Size, SUM(Quantity) AS TotalPizzasSold
   FROM OrderItems OI
   JOIN Pizzas P ON OI.PizzaID = P.PizzaID
   GROUP BY Size;
   ```

5. **Calculate the total amount spent by each customer.**  
   ```sql
   SELECT O.CustomerID, SUM(OI.Quantity * OI.Price) AS TotalSpent
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY O.CustomerID;
   ```

6. **Find the total number of orders placed on each day.**  
   ```sql
   SELECT OrderDate, COUNT(*) AS TotalOrders
   FROM Orders
   GROUP BY OrderDate;
   ```

7. **List the number of customers who placed orders from each city.**  
   ```sql
   SELECT C.City, COUNT(DISTINCT O.CustomerID) AS TotalCustomers
   FROM Customers C
   JOIN Orders O ON C.CustomerID = O.CustomerID
   GROUP BY C.City;
   ```

8. **Find the total revenue generated each month.**  
   ```sql
   SELECT DATEPART(YEAR, OrderDate) AS Year, DATEPART(MONTH, OrderDate) AS Month, 
          SUM(OI.Quantity * OI.Price) AS MonthlyRevenue
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY DATEPART(YEAR, OrderDate), DATEPART(MONTH, OrderDate);
   ```

9. **Calculate the total quantity of each topping ordered.**  
   ```sql
   SELECT T.ToppingName, SUM(OI.Quantity) AS TotalQuantity
   FROM OrderItems OI
   JOIN PizzaToppings PT ON OI.PizzaID = PT.PizzaID
   JOIN Toppings T ON PT.ToppingID = T.ToppingID
   GROUP BY T.ToppingName;
   ```

10. **Find the average order amount for each customer.**  
    ```sql
    SELECT O.CustomerID, AVG(OI.Quantity * OI.Price) AS AverageOrderAmount
    FROM Orders O
    JOIN OrderItems OI ON O.OrderID = OI.OrderID
    GROUP BY O.CustomerID;
    ```

---

Would you like me to continue with the next set of questions, or focus on specific ones?

---

### **Grouping by Multiple Columns**

11. Find the total revenue generated by each pizza for each size.  
12. Calculate the number of orders placed by each customer for each year.  
13. Find the total number of pizzas sold for each size and category (Veg/Non-Veg).  
14. List the total revenue generated by each customer for each year.  
15. Calculate the number of orders delivered by each delivery agent each month.  
16. Find the total quantity of each pizza ordered in each city.  
17. Calculate the number of pizzas sold for each category (Veg/Non-Veg) on each day.  
18. Find the total revenue generated for each payment method.  
19. Calculate the total revenue generated by each topping for each year.  
20. Find the number of orders placed by each customer for each payment method.  

---

Here’s the continuation of the **SQL answers for all 50 questions** with explanations. Each query explanation includes how `GROUP BY` and related SQL operations work for the specific question.  

---

### **Basic Aggregations (Continued)**

11. **Find the total revenue generated by each pizza for each size.**  
   ```sql
   SELECT P.PizzaID, P.Size, SUM(OI.Quantity * OI.Price) AS TotalRevenue
   FROM OrderItems OI
   JOIN Pizzas P ON OI.PizzaID = P.PizzaID
   GROUP BY P.PizzaID, P.Size;
   ```
   **Explanation:** The `GROUP BY` groups rows by `PizzaID` and `Size`. `SUM()` aggregates the total revenue for each pizza and size combination.

12. **Calculate the number of orders placed by each customer for each year.**  
   ```sql
   SELECT CustomerID, YEAR(OrderDate) AS Year, COUNT(*) AS TotalOrders
   FROM Orders
   GROUP BY CustomerID, YEAR(OrderDate);
   ```
   **Explanation:** The `GROUP BY` uses both `CustomerID` and the year extracted from `OrderDate` to compute the total orders for each year for every customer.

13. **Find the total number of pizzas sold for each size and category (Veg/Non-Veg).**  
   ```sql
   SELECT P.Size, P.Category, SUM(OI.Quantity) AS TotalPizzasSold
   FROM OrderItems OI
   JOIN Pizzas P ON OI.PizzaID = P.PizzaID
   GROUP BY P.Size, P.Category;
   ```
   **Explanation:** Rows are grouped by both `Size` and `Category`. The `SUM()` function aggregates the total quantities for each group.

14. **List the total revenue generated by each customer for each year.**  
   ```sql
   SELECT O.CustomerID, YEAR(O.OrderDate) AS Year, SUM(OI.Quantity * OI.Price) AS TotalRevenue
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY O.CustomerID, YEAR(O.OrderDate);
   ```
   **Explanation:** Groups are created based on `CustomerID` and year, and revenue is summed for each customer-year combination.

15. **Calculate the number of orders delivered by each delivery agent each month.**  
   ```sql
   SELECT DeliveryAgentID, YEAR(OrderDate) AS Year, MONTH(OrderDate) AS Month, COUNT(*) AS TotalOrders
   FROM Orders
   GROUP BY DeliveryAgentID, YEAR(OrderDate), MONTH(OrderDate);
   ```
   **Explanation:** `GROUP BY` combines `DeliveryAgentID`, year, and month, allowing `COUNT()` to calculate the number of deliveries for each agent in each month.

16. **Find the total quantity of each pizza ordered in each city.**  
   ```sql
   SELECT P.PizzaID, C.City, SUM(OI.Quantity) AS TotalQuantity
   FROM OrderItems OI
   JOIN Orders O ON OI.OrderID = O.OrderID
   JOIN Customers C ON O.CustomerID = C.CustomerID
   JOIN Pizzas P ON OI.PizzaID = P.PizzaID
   GROUP BY P.PizzaID, C.City;
   ```
   **Explanation:** Rows are grouped by `PizzaID` and `City`. The `SUM()` calculates the total pizza quantities for each pizza-city pair.

17. **Calculate the number of pizzas sold for each category (Veg/Non-Veg) on each day.**  
   ```sql
   SELECT P.Category, O.OrderDate, SUM(OI.Quantity) AS TotalPizzasSold
   FROM OrderItems OI
   JOIN Pizzas P ON OI.PizzaID = P.PizzaID
   JOIN Orders O ON OI.OrderID = O.OrderID
   GROUP BY P.Category, O.OrderDate;
   ```
   **Explanation:** `GROUP BY` uses `Category` and `OrderDate` to group data, while `SUM()` computes the total quantities.

18. **Find the total revenue generated for each payment method.**  
   ```sql
   SELECT PaymentMethod, SUM(OI.Quantity * OI.Price) AS TotalRevenue
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY PaymentMethod;
   ```
   **Explanation:** The `GROUP BY` groups rows by `PaymentMethod`, allowing `SUM()` to calculate total revenue for each method.

19. **Calculate the total revenue generated by each topping for each year.**  
   ```sql
   SELECT T.ToppingName, YEAR(O.OrderDate) AS Year, SUM(OI.Quantity * OI.Price) AS TotalRevenue
   FROM OrderItems OI
   JOIN PizzaToppings PT ON OI.PizzaID = PT.PizzaID
   JOIN Toppings T ON PT.ToppingID = T.ToppingID
   JOIN Orders O ON OI.OrderID = O.OrderID
   GROUP BY T.ToppingName, YEAR(O.OrderDate);
   ```
   **Explanation:** Groups are created using `ToppingName` and year. `SUM()` calculates total revenue for each topping-year pair.

20. **Find the number of orders placed by each customer for each payment method.**  
   ```sql
   SELECT O.CustomerID, O.PaymentMethod, COUNT(*) AS TotalOrders
   FROM Orders O
   GROUP BY O.CustomerID, O.PaymentMethod;
   ```
   **Explanation:** `GROUP BY` groups rows by `CustomerID` and `PaymentMethod`. `COUNT()` calculates the total orders for each combination.

---

Let me know if you’d like to continue from **21 to 50** or need detailed explanations for any specific ones!

---
### **Using HAVING Clause**

21. Find customers who have placed more than 10 orders.  
22. List pizzas that have generated more than $500 in revenue.  
23. Identify delivery agents who have delivered more than 50 orders.  
24. Find the months where revenue exceeded $10,000.  
25. List customers who spent more than $1,000 in total.  
26. Find pizzas that were ordered more than 100 times.  
27. Identify cities where more than 50 orders were placed.  
28. List customers who placed more than 5 orders in a single month.  
29. Find the years where more than 1,000 pizzas were sold.  
30. Identify customers who ordered more than 3 different pizzas in a single order.  

---

### **Using `HAVING` Clause**

21. **Find customers who have placed more than 10 orders.**  
   ```sql
   SELECT CustomerID, COUNT(*) AS TotalOrders
   FROM Orders
   GROUP BY CustomerID
   HAVING COUNT(*) > 10;
   ```
   **Explanation:** The `HAVING` clause filters groups where the count of orders exceeds 10 after grouping by `CustomerID`.

22. **List pizzas that have generated more than $500 in revenue.**  
   ```sql
   SELECT PizzaID, SUM(Quantity * Price) AS TotalRevenue
   FROM OrderItems
   GROUP BY PizzaID
   HAVING SUM(Quantity * Price) > 500;
   ```
   **Explanation:** After grouping by `PizzaID`, the `HAVING` clause filters out pizzas with revenue below $500.

23. **Identify delivery agents who have delivered more than 50 orders.**  
   ```sql
   SELECT DeliveryAgentID, COUNT(*) AS TotalDeliveries
   FROM Orders
   GROUP BY DeliveryAgentID
   HAVING COUNT(*) > 50;
   ```
   **Explanation:** The `HAVING` clause retains groups where the delivery count exceeds 50.

24. **Find the months where revenue exceeded $10,000.**  
   ```sql
   SELECT YEAR(OrderDate) AS Year, MONTH(OrderDate) AS Month, SUM(Quantity * Price) AS TotalRevenue
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY YEAR(OrderDate), MONTH(OrderDate)
   HAVING SUM(Quantity * Price) > 10000;
   ```
   **Explanation:** The `HAVING` clause filters month-year combinations with revenue greater than $10,000.

25. **List customers who spent more than $1,000 in total.**  
   ```sql
   SELECT O.CustomerID, SUM(OI.Quantity * OI.Price) AS TotalSpent
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY O.CustomerID
   HAVING SUM(OI.Quantity * OI.Price) > 1000;
   ```
   **Explanation:** After grouping by `CustomerID`, the `HAVING` clause ensures only customers with spending over $1,000 are included.

26. **Find pizzas that were ordered more than 100 times.**  
   ```sql
   SELECT PizzaID, SUM(Quantity) AS TotalQuantity
   FROM OrderItems
   GROUP BY PizzaID
   HAVING SUM(Quantity) > 100;
   ```
   **Explanation:** The `HAVING` clause filters out pizzas ordered fewer than 100 times.

27. **Identify cities where more than 50 orders were placed.**  
   ```sql
   SELECT C.City, COUNT(O.OrderID) AS TotalOrders
   FROM Customers C
   JOIN Orders O ON C.CustomerID = O.CustomerID
   GROUP BY C.City
   HAVING COUNT(O.OrderID) > 50;
   ```
   **Explanation:** Groups are created for each city, and the `HAVING` clause filters cities with fewer than 50 orders.

28. **List customers who placed more than 5 orders in a single month.**  
   ```sql
   SELECT CustomerID, YEAR(OrderDate) AS Year, MONTH(OrderDate) AS Month, COUNT(*) AS TotalOrders
   FROM Orders
   GROUP BY CustomerID, YEAR(OrderDate), MONTH(OrderDate)
   HAVING COUNT(*) > 5;
   ```
   **Explanation:** Grouped by `CustomerID`, year, and month, then filtered for groups with more than 5 orders.

29. **Find the years where more than 1,000 pizzas were sold.**  
   ```sql
   SELECT YEAR(OrderDate) AS Year, SUM(OI.Quantity) AS TotalPizzas
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY YEAR(OrderDate)
   HAVING SUM(OI.Quantity) > 1000;
   ```
   **Explanation:** The `HAVING` clause filters years with fewer than 1,000 pizzas sold.

30. **Identify customers who ordered more than 3 different pizzas in a single order.**  
   ```sql
   SELECT OrderID, CustomerID, COUNT(DISTINCT PizzaID) AS DifferentPizzas
   FROM OrderItems
   GROUP BY OrderID, CustomerID
   HAVING COUNT(DISTINCT PizzaID) > 3;
   ```
   **Explanation:** Groups by `OrderID` and `CustomerID`, then filters orders with more than 3 unique pizzas.

---

---

### **Advanced Grouping and Filtering**

31. Find the average revenue generated by each pizza, filtering out those below $100.  
32. List cities where the average order amount exceeds $50.  
33. Identify months where the total revenue for Veg pizzas exceeded that for Non-Veg pizzas.  
34. Find the total quantity of each pizza ordered, filtering out pizzas sold less than 50 times.  
35. List delivery agents who delivered to more than 10 unique customers.  
36. Find the most popular pizza in each city (based on quantity sold).  
37. Identify the month with the highest revenue for each customer.  
38. List customers who placed orders totaling more than $500 in a single day.  
39. Find cities where more than 100 pizzas were sold in a single month.  
40. Identify pizzas that generated more than $1,000 in revenue in a single year.  

---


### **Advanced Grouping and Filtering**

31. **Find the average revenue generated by each pizza, filtering out those below $100.**  
   ```sql
   SELECT PizzaID, AVG(Quantity * Price) AS AverageRevenue
   FROM OrderItems
   GROUP BY PizzaID
   HAVING AVG(Quantity * Price) >= 100;
   ```
   **Explanation:** The `HAVING` clause filters groups based on average revenue.

32. **List cities where the average order amount exceeds $50.**  
   ```sql
   SELECT C.City, AVG(OI.Quantity * OI.Price) AS AvgOrderAmount
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   JOIN Customers C ON O.CustomerID = C.CustomerID
   GROUP BY C.City
   HAVING AVG(OI.Quantity * OI.Price) > 50;
   ```
   **Explanation:** Groups by city and filters those with average order amounts exceeding $50.

33. **Identify months where total revenue for Veg pizzas exceeded Non-Veg pizzas.**  
   ```sql
   SELECT YEAR(O.OrderDate) AS Year, MONTH(O.OrderDate) AS Month, 
          P.Category, SUM(OI.Quantity * OI.Price) AS TotalRevenue
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   JOIN Pizzas P ON OI.PizzaID = P.PizzaID
   GROUP BY YEAR(O.OrderDate), MONTH(O.OrderDate), P.Category
   HAVING P.Category = 'Veg' AND TotalRevenue > (
       SELECT SUM(OI2.Quantity * OI2.Price)
       FROM OrderItems OI2
       JOIN Pizzas P2 ON OI2.PizzaID = P2.PizzaID
       WHERE P2.Category = 'Non-Veg'
   );
   ```
   **Explanation:** Compare grouped sums for each category in a month-year combination.

Here are the remaining **34 to 50** SQL queries, complete with explanations.  

---

### **Advanced Grouping and Filtering (Continued)**

34. **Find customers who ordered pizzas with more than 3 toppings on average.**  
   ```sql
   SELECT O.CustomerID, AVG(PT.ToppingCount) AS AvgToppings
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   JOIN (SELECT PizzaID, COUNT(ToppingID) AS ToppingCount FROM PizzaToppings GROUP BY PizzaID) PT 
     ON OI.PizzaID = PT.PizzaID
   GROUP BY O.CustomerID
   HAVING AVG(PT.ToppingCount) > 3;
   ```
   **Explanation:** The subquery calculates the number of toppings per pizza. The main query groups by `CustomerID` and filters based on the average topping count.

35. **List cities where more than 100 pizzas were ordered in total.**  
   ```sql
   SELECT C.City, SUM(OI.Quantity) AS TotalPizzasOrdered
   FROM Customers C
   JOIN Orders O ON C.CustomerID = O.CustomerID
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY C.City
   HAVING SUM(OI.Quantity) > 100;
   ```
   **Explanation:** Groups by city, filters cities with total pizza orders exceeding 100.

36. **Find delivery agents who delivered orders totaling more than $2,000 in revenue.**  
   ```sql
   SELECT DeliveryAgentID, SUM(OI.Quantity * OI.Price) AS TotalRevenue
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY DeliveryAgentID
   HAVING SUM(OI.Quantity * OI.Price) > 2000;
   ```
   **Explanation:** After grouping by `DeliveryAgentID`, the `HAVING` clause filters those whose deliveries generated over $2,000 in revenue.

37. **Identify years where Non-Veg pizzas made up more than 60% of total revenue.**  
   ```sql
   SELECT YEAR(O.OrderDate) AS Year, 
          SUM(CASE WHEN P.Category = 'Non-Veg' THEN OI.Quantity * OI.Price ELSE 0 END) AS NonVegRevenue,
          SUM(OI.Quantity * OI.Price) AS TotalRevenue
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   JOIN Pizzas P ON OI.PizzaID = P.PizzaID
   GROUP BY YEAR(O.OrderDate)
   HAVING (SUM(CASE WHEN P.Category = 'Non-Veg' THEN OI.Quantity * OI.Price ELSE 0 END) / 
           SUM(OI.Quantity * OI.Price)) > 0.6;
   ```
   **Explanation:** Uses conditional aggregation (`CASE`) to calculate revenue for Non-Veg pizzas and filters years where it exceeds 60% of total revenue.

38. **Find the average number of pizzas per order for each city.**  
   ```sql
   SELECT C.City, AVG(OrderItemCount) AS AvgPizzasPerOrder
   FROM Customers C
   JOIN Orders O ON C.CustomerID = O.CustomerID
   JOIN (SELECT OrderID, SUM(Quantity) AS OrderItemCount FROM OrderItems GROUP BY OrderID) OI 
     ON O.OrderID = OI.OrderID
   GROUP BY C.City;
   ```
   **Explanation:** A subquery calculates the total pizzas per order. The main query groups by city and averages the values.

39. **List customers who placed orders in every year for the past 5 years.**  
   ```sql
   SELECT CustomerID
   FROM Orders
   WHERE YEAR(OrderDate) >= YEAR(GETDATE()) - 5
   GROUP BY CustomerID
   HAVING COUNT(DISTINCT YEAR(OrderDate)) = 5;
   ```
   **Explanation:** Filters orders from the past 5 years and ensures each customer appears in all 5 years using `HAVING` with `COUNT(DISTINCT YEAR)`.

40. **Find the largest single order (by quantity) for each customer.**  
   ```sql
   SELECT CustomerID, MAX(OrderQuantity) AS LargestOrder
   FROM (
       SELECT O.CustomerID, OI.OrderID, SUM(OI.Quantity) AS OrderQuantity
       FROM Orders O
       JOIN OrderItems OI ON O.OrderID = OI.OrderID
       GROUP BY O.CustomerID, OI.OrderID
   ) AS SubQuery
   GROUP BY CustomerID;
   ```
   **Explanation:** A subquery calculates the total quantity for each order. The main query finds the maximum order per customer.

---


Let me know if further clarification is needed!


---

### **Combined Aggregations**

41. Calculate the percentage contribution of each pizza to total revenue.  
42. Find the customer with the highest total spending in each city.  
43. Calculate the average order value for each customer each year.  
44. Find the top 3 pizzas ordered in each category (Veg/Non-Veg).  
45. Calculate the month-on-month revenue growth for each city.  
46. Identify customers who ordered more than 5 pizzas in more than 2 different sizes.  
47. Find the delivery agent with the most orders each month.  
48. List the number of times each pizza was ordered with specific additional toppings.  
49. Find the total revenue for each customer who ordered more than 3 different pizzas.  
50. Identify the top 3 cities with the highest revenue in each year.  

---


### **Combination of Aggregates and Filtering**

41. **Identify the top 3 cities with the highest revenue.**  
   ```sql
   SELECT TOP 3 C.City, SUM(OI.Quantity * OI.Price) AS TotalRevenue
   FROM Customers C
   JOIN Orders O ON C.CustomerID = O.CustomerID
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY C.City
   ORDER BY TotalRevenue DESC;
   ```
   **Explanation:** `GROUP BY` groups by city, and `ORDER BY` ranks the cities by revenue. `TOP 3` limits results.

42. **Find the top 5 customers who spent the most.**  
   ```sql
   SELECT TOP 5 O.CustomerID, SUM(OI.Quantity * OI.Price) AS TotalSpent
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY O.CustomerID
   ORDER BY TotalSpent DESC;
   ```
   **Explanation:** Groups by `CustomerID`, sums their spending, and ranks them in descending order.

43. **List delivery agents who delivered more than 100 pizzas in total.**  
   ```sql
   SELECT DeliveryAgentID, SUM(OI.Quantity) AS TotalPizzas
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY DeliveryAgentID
   HAVING SUM(OI.Quantity) > 100;
   ```
   **Explanation:** Groups by `DeliveryAgentID` and filters by total pizzas delivered.

44. **Find cities where the average order amount exceeds $75.**  
   ```sql
   SELECT C.City, AVG(OI.Quantity * OI.Price) AS AvgOrderAmount
   FROM Customers C
   JOIN Orders O ON C.CustomerID = O.CustomerID
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   GROUP BY C.City
   HAVING AVG(OI.Quantity * OI.Price) > 75;
   ```
   **Explanation:** Groups orders by city and filters by average order amount.

45. **List the most popular pizza in each city.**  
   ```sql
   SELECT City, PizzaID, MAX(PizzaOrders) AS MaxOrders
   FROM (
       SELECT C.City, OI.PizzaID, SUM(OI.Quantity) AS PizzaOrders
       FROM Customers C
       JOIN Orders O ON C.CustomerID = O.CustomerID
       JOIN OrderItems OI ON O.OrderID = OI.OrderID
       GROUP BY C.City, OI.PizzaID
   ) AS SubQuery
   GROUP BY City, PizzaID;
   ```
   **Explanation:** Calculates total orders for each pizza in each city, then finds the most ordered one.

46. **Find customers who ordered more than one category of pizza in a single order.**  
   ```sql
   SELECT O.CustomerID, OI.OrderID
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   JOIN Pizzas P ON OI.PizzaID = P.PizzaID
   GROUP BY O.CustomerID, OI.OrderID
   HAVING COUNT(DISTINCT P.Category) > 1;
   ```
   **Explanation:** Groups by order and customer, filters for orders with multiple categories.

47. **Calculate the total revenue generated by the top 5 pizzas.**  
   ```sql
   SELECT TOP 5 PizzaID, SUM(Quantity * Price) AS TotalRevenue
   FROM OrderItems
   GROUP BY PizzaID
   ORDER BY TotalRevenue DESC;
   ```
   **Explanation:** Groups by `PizzaID` and calculates revenue, limiting results to the top 5.

48. **List months where revenue from Veg pizzas was greater than Non-Veg pizzas.**  
   ```sql
   SELECT YEAR(OrderDate) AS Year, MONTH(OrderDate) AS Month
   FROM Orders O
   JOIN OrderItems OI ON O.OrderID = OI.OrderID
   JOIN Pizzas P ON OI.PizzaID = P.PizzaID
   GROUP BY YEAR(OrderDate), MONTH(OrderDate)
   HAVING SUM(CASE WHEN P.Category = 'Veg' THEN OI.Quantity * OI.Price ELSE 0 END) > 
          SUM(CASE WHEN P.Category = 'Non-Veg' THEN OI.Quantity * OI.Price ELSE 0 END);
   ```
   **Explanation:** Compares revenue for each category in grouped month-year combinations.

49. **Find customers who spent at least $500 in a single order.**  
   ```sql
   SELECT CustomerID, OrderID, SUM(Quantity * Price) AS OrderAmount
   FROM OrderItems
   GROUP BY CustomerID, OrderID
   HAVING SUM(Quantity * Price) >= 500;
   ```
   **Explanation:** Filters orders based on their total amount after grouping by `OrderID`.

50. **Identify years where overall revenue increased compared to the previous year.**  
   ```sql
   SELECT Year, TotalRevenue
   FROM (
       SELECT YEAR(OrderDate) AS Year, SUM(OI.Quantity * OI.Price) AS Total
    Revenue
       FROM Orders O
       JOIN OrderItems OI ON O.OrderID = OI.OrderID
       GROUP BY YEAR(OrderDate)
   ) AS YearlyRevenue
   WHERE TotalRevenue > LAG(TotalRevenue) OVER (ORDER BY Year);
   ```
   **Explanation:** Uses the `LAG` function to compare yearly revenues and filters for increases.

---

These questions provide a wide range of practice opportunities for grouping data and using `HAVING` to filter aggregated results. Let me know if you’d like explanations or SQL queries for any specific ones!